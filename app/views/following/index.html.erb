<h1><img id="avatar" src="<%= @avatar %>" alt="avatar"><%= @user.username %>'s Portfolio</h1>

<%= link_to "Back to Coins", root_url %>

<div class="row">
  <% count = 0 %>
  <% @following.each do |follow| %>
     <div class="col s6">
       <h1><%= follow.coin_name %></h1>
         <% @response_only_btc.each do |coin| %>
            <% if coin["MarketName"] == "BTC-#{follow.coin_name}" %>
            <% @coin_last = coin["Last"] %>
            <% end %>
         <% end %>
        <h5>Current Price: &#579; <%= number_with_precision(@coin_last, precision: 8) %></h5>

     <table class="bordered">
       <thead>
         <tr>
             <th data-sortable="false">Price above</th>
             <th data-sortable="false">Price below</th>
             <th data-sortable="false">24h change</th>
             <th data-sortable="false">Status</th>
             <th></th>
         </tr>
       </thead>
       <tbody>
         <% follow.alerts.each do |alert| %>
           <tr>
             <td><%= alert.price_above %></td>
             <td><%= alert.price_below %></td>
             <td><%= alert.percent %>%</td>
             <td><%= alert.state %></td>
             <td><%= link_to "Edit", edit_following_alert_path(follow, alert) %> | <%= link_to "Delete", following_alert_path(follow, alert), method: :delete, data: {confirm: "Are you sure you want to delete this alert?" } %></td>
           </tr>
         <% end %>
         <tr>
           <td colspan="4">
             <button data-target="modal<%= count +=1%>" class="btn modal-trigger cyan accent-4" action="#modal<%= count %>"><i class="material-icons left  modal-trigger">add</i>Add Alert</button>
           </td>
         </tr>
            <div id="modal<%= count %>" class="modal">
              <div class="modal-content">
              <!-- cannot render the partial for the alert. for NEW method, it can't be @following, must be >>follow<< like in the iteration -->
              <%= form_for([follow, @alert]) do |f| %>
                <% if @alert.errors.any? %>
                  <div id="error_explanation">
                    <h2><%= pluralize(@alert.errors.count, "error") %> prohibited this alert from being saved:</h2>
                    <ul>
                      <% @alert.errors.full_messages.each do |msg| %>
                        <li><%= msg %></li>
                      <% end %>
                    </ul>
                  </div>
                <% end %>
                <h5><%= follow.coin_name %></h5>
                <div class="field">
                  <%= f.label :price_above %><br />
                  <%= f.text_field :price_above, :value => number_with_precision(@coin_last, precision: 8) %>
                </div>
                <div class="field">
                  <%= f.label :price_below %><br />
                  <%= f.text_field :price_below, :value => number_with_precision(@coin_last, precision: 8)%>
                </div>
                <div class="field">
                  <%= f.label '24h percent change' %><br />
                  <%= f.text_field :percent %>
                </div>
                <div class="actions">
                  <%= f.submit %>
                </div>
              <% end %>
            </div>
            </div>
       </tbody>
     </table>
   </div>
   <% end %>
 </div>
